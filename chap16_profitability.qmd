---
title: "収益性の分析"
---


ここでは財務分析で最も重要である収益性分析について学習します。
本章で利用するパッケージを読み込みます。

```{r}
library(tidyverse)
library(ggthemes)
library(patchwork)
library(kableExtra)
knitr::opts_chunk$set(dev = "ragg_png")
```

また、この章で扱うデータは以下の通りです。
2008年1月1日から2023年3月31日の期間に、東京証券取引所に上場している、従業員が500名以上の企業2066社を対象に、以下の25項目のデータを取得しています。
「連結優先」として、IFRS、米国基準、日本連結、日本単独の順でデータを取得しています。

- `R001` 決算月数
- `R018` 上場場部：コード
- `R022` 日経業種：コード
- `B022` 現金・預金／現金及び現金同等物
- `B023` 受取手形・売掛金及び契約資産／売掛金及びその他の短期債権
- `B033` 有価証券
- `B034` 棚卸資産
- `B063` 有形固定資産
- `B051` 短期貸付金
- `B084` 投資・その他の資産合計
- `B087` （関係会社有価証券）／（持分法で会計処理されている投資）
- `B110` 資産合計
- `C082` 負債合計
- `C085` 資本金
- `C087` 資本剰余金
- `C092` 利益剰余金
- `C097` 自己株式（▲）
- `C098` 評価・換算差額等／累積その他の包括利益
- `D021` 売上高
- `D024` 売上原価
- `D029` 営業利益
- `D031` 受取利息・配当金
- `D042` 持分法による投資利益
- `D062` 持分法による投資損失
- `D110` 親会社株主に帰属する当期純利益（連結）／当期利益（単独）［累計］

社会科学情報検索システムで項目をまとめて取得する場合は、以下の項目を指定してください。

```
R001,R018,R022,B022,B023,B033,B034,B063,B051,B084,B087,B110,C082,C085,C087,C092,C097,C098,D021,D029,D024,D031,D042,D062,D110
```

早速データを読み込んでみましょう。
同時に、変数名を半角英数のスネークケースに変換します。

```{r}
df <- read_csv("data/profitability.csv")
df <- df |>
   rename(
      nikkei_code = "日経会社コード",
      name = "企業名称",
      date = "決算期",
      shubetsu = "決算種別",
      renketsu = "連結基準",
      kessan_months = "決算月数",
      listed_code = "上場場部：コード",
      industry_code = "日経業種：コード",
      cash = "現金・預金／現金及び現金同等物",
      receivable = "受取手形・売掛金及び契約資産／売掛金及びその他の短期債権",      securities = "有価証券",
      inventory = "棚卸資産",
      tangible_asset = "有形固定資産",
      short_loan = "短期貸付金",
      total_investments = "投資・その他の資産合計",
      affiliated_securities = "（関係会社有価証券）／（持分法で会計処理されている投資）",
      total_asset = "資産合計",
      total_debt = "負債合計",
      equity = "資本金",
      capital_surplus = "資本剰余金",
      earned_surplus = "利益剰余金",
      treasury_stock = "自己株式（▲）",
      accumulated_OCI= "評価・換算差額等／累積その他の包括利益",
      sales = "売上高・営業収益［累計］",
      operating_income = "営業利益［累計］",
      cogs = "売上原価・営業原価［累計］",
      interest_devidend = "受取利息・配当金［累計］",
      moti_rieki = "持分法による投資利益［累計］",
      moti_son = "持分法による投資損失［累計］",
      net_income = "親会社株主に帰属する当期純利益（連結）／当期利益（単独）［累計］"
      )
```

データの構造を確認してみましょう。

```{r}
summary(df)
```

カテゴリー変数をファクター型に変更したり、決算期を日付に変換したり、異常値を除去したり、欠損値にゼロを代入したりしておきます。

```{r}
df <- df |>
# 決算月数が12ヶ月で、売上高、資産合計、資本金が0超の企業を抽出
   filter(
      kessan_months == 12,
      sales > 0,
      total_asset > 0,
      equity > 0
   )
```
欠損値にゼロを代入します。

```{r}
# データフレームdfに対して、すべての列のNAを0に置き換える
df <- df |>
  mutate(across(everything(), ~replace(., is.na(.), 0)))
```

カテゴリー変数をファクター型に変更します。

```{r}
df <- df |>
   mutate(
      year = substr(date, 1, 4),
      listed_code = factor(listed_code),
      industry_code = factor(industry_code),
   )
```

おおよその前処理が終わりました。

## 資本利益率

企業分析で最も重要な視点の1つが，企業の収益性(profitability)です。
収益性とは，企業が資金を投下した**資本**(capital)に対して，どれだけの**リターン**(return)が生み出されているかを示す指標です。
したがって収益性の尺度は，資本とリターンの組み合わせで決まり，分析視点として

1. 企業全体の収益性
2. 株主の観点からみた収益性

があります。

| 資本概念 | リターン概念 | 視点 |
|---|---|---|
| 総資本 | 事業利益 | 企業全体 |
| 事業資産 | 営業利益 | 企業全体 |
| 自己資本 | 純利益 | 株主 |


- 総資本：純資産と負債の合計
- 事業資産：総資本から金融資産を除いたもの
- 自己資本：株主資本とその他包括利益累計額の合計


### 企業全体の収益性

企業全体の収益性を表す尺度として，**総資本事業利益率**があります。
**総資本**とは，他人資本と自己資本の合計であり，資本利用者からみた企業全体の利益率を表しています。

総資本と総資産は等しいので，総資本事業利益率は総資産利益率(return on asset)，通称**ROA**とも呼ばれます。
定義は以下の通りです。

$$
総資本事業利益率_t = \frac{営業利益_t + 受取利息・配当金_t + 持分法利益_t}{(使用総資本_t + 使用総資本_{t-1} )/2}
$$

分子がフロー項目なので，分母も使用総資本の変化を考慮した平均値を用いています。

:::{.column-margin}
理論的には，分子の利益等の項目が期末の使用総資本に含められているため，分母に期末総資本を用いるのは，分母と分子の対応関係として整合的ではないのですが，実務的に平均値を用いることが多いようです。
理論的には，期首総資本を用いるべきです(太田本より)が，期中に組織再編など使用総資本が大きく動いている場合もあるので，ケースバイケースです。
:::

具体的に計算してみましょう。

```{r}
df <- df |>
   group_by(nikkei_code) |>
   mutate(
      roa = (operating_income + interest_devidend + moti_rieki) / ((total_asset + lag(total_asset)) / 2)
   )
summary(df$roa)
```
平均ROAが6.27％、中央値が5.40%となっており、分布が右に歪んでいることがわかります。
最大値が121.42%と、総資産の1.2倍もの事業利益をあげている企業が存在し、このような企業が平均値を右にシフトさせている可能性があります。
ヒストグラムで確認してみましょう。

```{r}
#| warning: false
g <- ggplot(df) + aes(roa) +
   geom_histogram(binwidth = 0.05, fill = "skyblue", color = "black") +
   theme_minimal()
print(g)
```

### 株主から見た収益性

株式会社の主たる出資者である株主からみた収益性は，**自己資本純利益率**(return on equity)，通称**ROE**があります。
定義は以下の通りです。

$$
ROE = \frac{親会社株主に帰属する当期純利益_t}{(自己資本_t + 自己資本_{t-1})/2}
$$

株主に帰属する資本を表す**自己資本**の金額は貸借対照表に記載されていないので，自分で計算する必要があります。

:::{.column-margin}
自己資本とは，他人資本(つまり負債)に対応する概念で，B/Sの右側を総資本とする場合，株主から調達した資本を自己資本，他人から調達した資本(つまり負債)を他人資本とよびます。
この自己資本とは別に，東京証券取引所がROEの算定で用いる自己資本があり，この資料ではこの意味で自己資本を使います。
:::

東京証券取引所の定義は以下の通りです。

$$
自己資本 = 株主資本 + その他の包括利益累計額
$$

です。

なぜこれが株主に帰属する自己資本になるのか考えてみましょう。
第1項である株主資本は，

1. 資本金
2. 資本剰余金
   1. 資本準備金
   2. その他資本剰余金
3. 利益剰余金
   1. 利益準備金
   2. その他利益剰余金
4. 自己株式

から構成されています。
このうち，資本金と資本剰余金は株主の出資した資本であり，利益剰余金は企業が獲得した利益のうち企業内に留保された部分(**内部留保**ともいいます)です。
自己株式は，保有している自社株式の取得原価を表しています。
自社が発行した株式を保有しているということは，実質的に資本の払い戻しをしていることになるため，株主資本のマイナス項目として扱われます。
つまり，株主資本は，

$$
株主資本 = 資本金 + 資本剰余金 + 利益剰余金 - 自己株式
$$

で計算されます。

次に，その他の包括利益累計額は，未実現利益の累積額であり，価値変動が把握でき，純資産の価値を変動させるものです。
たとえば，現実的に売却が困難な持ち合い上場株式はその他有価証券として区分され，時価評価の対象となりますが，その評価損益を実現させることができないため，その他包括利益累計額に計上されます。

:::{.column-margin}
この定義は，「企業内容等の開示に関する内閣府令」で定めている第2様式と第3様式で採用されているものです。
:::

具体的に計算してみましょう。
自己資本とROEを計算します。
```{r}
df <- df |>
   mutate(
      net_worth = equity + capital_surplus + earned_surplus - treasury_stock,
      roe = net_income / ((net_worth + lag(net_worth)) / 2)
   )
summary(df$roe)
```

平均ROEが`r round(mean(df$roe, na.rm = TRUE) * 100, digits = 2)`%、中央値が`r round(median(df$roe, na.rm = TRUE) * 100, digits = 2)`%となっており、今度は分布が左に歪んでいることがわかります。
最小値をみると、ROEが-5600%という企業が存在していることが分かります。どんな会社かみてみましょう。

```{r}
df |>
   filter(roe < -56) |>
   select(name, year, net_worth, net_income, roe)
```

タカキューでした。
タカキュー(8166)は、昭和25年に東京で設立した小売業を営む株式会社です。
資本金は1億円で東証スタンダードに上場していますが、2022年度から債務超過となっており、
2024年2月29日までに債務超過が解消できない場合は上場廃止となる、財務的困窮状態にある企業です。
タカキューのデータ全体をみてみましょう。

```{r}
df |>
   filter(nikkei_code == "0025720") |>
   select(name, year, net_worth, net_income, roe) |>
   kable() |> kable_styling(font_size = 12)
```

2019年度から赤字が続き、2022年度から自己資本がマイナスになっています。
しかし分母は前期末との平均値を使うため、分母が非常に小さな正の値になり、分子にが大きな赤字となっているため、ROEが非常に大きなマイナス値になっています。
ROEの計算では、分母も分子もマイナスでROEがプラスになることもあるため、自己資本がマイナスのケースは除外するようにします。

```{r}
df <- df |>
   filter(net_worth > 0)
```

ヒストグラムで確認してみましょう。

```{r}
ggplot(df) + aes(roe) +
   geom_histogram(binwidth = 0.05, fill = "skyblue", color = "black") +
   theme_minimal()
```

ROEのレンジが広すぎるため、ヒストグラムが棒のようになっています。
極端な値を除外するか、表示する区間を絞るかしてみましょう。
以下では、表示する区間を-1から1に限定し、平均値を赤線で表示しています。
```{r}
#| warning: false
ggplot(df) + aes(roe) +
   geom_histogram(binwidth = 0.05, fill = "skyblue", color = "black") +
   xlim(-1, 1) +
   geom_vline(xintercept = mean(df$roe, na.rm = TRUE), color = "red") +
   theme_minimal()
```

次に、上場企業のROE平均がどのように推移しているかを確認してみましょう。
`mean()`関数に`trim = 0.2`のオプションをつけて、
上下20%の値を除外した平均を計算してみます。
```{r}
#| warning: false
df |>
   filter(year > 2008) |> # lag()で消えた2008年を除外
   group_by(year) |>
   summarise(
      mean_roe = mean(roe, na.rm = TRUE, trim = 0.2)
   ) |>
   ggplot() + aes(year, mean_roe, group = 1) +
   geom_line() +
   theme_minimal()
```

2009年のリーマンショック期から2018年まではR0Eが右肩上がりで増加し、2020年のコロナ禍で減少、その後は回復していることがわかります。

製造業と非製造業でROEの推移が異なっているかどうかを確認してみましょう。
製造業ダミー変数を作成します。
```{r}
df <- df |>
   mutate(
      dai = substr(industry_code, 1, 1),
      manufactur = factor(dai, labels = c("製造業", "非製造業"), levels = c("1", "2"))
      )
df |>
   filter(year > 2008) |>
   group_by(year, manufactur) |>
   summarise(
      mean_roe = mean(roe, na.rm = TRUE, trim = 0.2)
   ) |>
   ggplot() + aes(year, mean_roe, group = manufactur, color = manufactur) +
   geom_line() +
   theme_minimal()
```

製造業の方がROEが低く、また景気の影響を受けやすいことが読み取れます。


## ROAの活動別分析

企業全体の投下資本に対する収益性を示すROAを、構成要素に基づいて企業活動別に分析してみましょう。

- 企業本来の営業活動に投下された資本：**経営資本**
- 余剰資金を運用する金融活動に投下された資本：**金融資本**

実際の区分方法として、金融資本を特定し、使用総資本から金融資本を除いて経営資本を計算します。

金融資本には以下のようなモノが含まれる。

- 現金預金
- 有価証券
- 短期貸付金
- 投資その他の資産(関連会社株式を除く)

経営資本は使用総資本から金融資本を除いたものであり、経営資本と対応する利益は営業利益です。
したがって、

$$
経営資本営業利益率 = \frac{(営業利益 + 持分法による投資損益)}{経営資本}
$$

金融活動の利益率は、

$$
金融活動利益率 = \frac{(受取利息 + 受取配当金)}{金融資本}
$$

それぞれ計算してみよう。
```{r}
df <- df |>
   mutate(
      金融資本 = (cash + securities + short_loan + total_investments - affiliated_securities),
      経営資本 = total_asset - 金融資本,
      経営資本営業利益率 = (operating_income + moti_rieki + moti_son) / 経営資本,
      金融活動利益率 = (interest_devidend) / 金融資本
   )
```

それぞれの時系列推移を産業別にプロットしてみましょう。
```{r}
df_roa_mean <- df |>
   filter(year > 2008) |>
   group_by(year, manufactur) |>
   summarise(
      平均経営資本営業利益率 = mean(経営資本営業利益率, na.rm = TRUE, trim = 0.1),
      平均金融活動利益率 = mean(金融活動利益率, na.rm = TRUE, trim = 0.1)
   )
ggplot(df_roa_mean) + aes(year, 平均経営資本営業利益率, group = manufactur, color = manufactur) +
   geom_line() +
   theme_minimal()
```


```{r}
ggplot(df_roa_mean) + 
   aes(year, 平均金融活動利益率, group = manufactur, color = manufactur) +
   geom_line() +
   theme_minimal()
```

## 資本利益率の分解

## 売上高利益率の分析

## 資本回転率の分析
